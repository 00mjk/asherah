<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1692px" preserveAspectRatio="none" style="width:1233px;height:1692px;" version="1.1" viewBox="0 0 1233 1692" width="1233px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="1271.4263" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="535" y="167.6694"/><rect fill="#FFFFFF" height="441.644" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1054" y="351.3018"/><rect fill="#FFFFFF" height="271.0117" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1054" y="988.5781"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="35" x2="35" y1="65.29" y2="1499.2222"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="189" x2="189" y1="65.29" y2="1499.2222"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="381.5" x2="381.5" y1="65.29" y2="1499.2222"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="539.5" x2="539.5" y1="65.29" y2="1499.2222"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="800.5" x2="800.5" y1="65.29" y2="1499.2222"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058.5" x2="1058.5" y1="65.29" y2="1499.2222"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1144.5" x2="1144.5" y1="65.29" y2="1499.2222"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1208.5" x2="1208.5" y1="65.29" y2="1499.2222"/><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="8" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="15" y="54.3027">Caller</text><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="8" y="1498.2222"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="15" y="1518.5249">Caller</text><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="36" x="171" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="22" x="178" y="54.3027">API</text><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="36" x="171" y="1498.2222"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="22" x="178" y="1518.5249">API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="203" x="277.5" y="62.3027">AppEncryptionSessionFactory</text><path d="M361.5,21 L361.5,45 M361.5,33 L378.5,33 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="390.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="203" x="277.5" y="1511.5249">AppEncryptionSessionFactory</text><path d="M361.5,1518.5122 L361.5,1542.5122 M361.5,1530.5122 L378.5,1530.5122 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="390.5" cy="1530.5122" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="503.5" y="30"/><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="499.5" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="506.5" y="54.3027">SK Cache</text><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="503.5" y="1498.2222"/><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="499.5" y="1502.2222"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="506.5" y="1522.5249">SK Cache</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="747.5" y="62.3027">AppEncryption</text><path d="M780.5,21 L780.5,45 M780.5,33 L797.5,33 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="809.5" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="101" x="747.5" y="1511.5249">AppEncryption</text><path d="M780.5,1518.5122 L780.5,1542.5122 M780.5,1530.5122 L797.5,1530.5122 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="809.5" cy="1530.5122" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="1024.5" y="30"/><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="1020.5" y="34"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="1027.5" y="54.3027">IK Cache</text><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="1024.5" y="1498.2222"/><rect fill="#FEFECE" height="30.29" style="stroke: #A80036; stroke-width: 1.5;" width="73" x="1020.5" y="1502.2222"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="1027.5" y="1522.5249">IK Cache</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="1107.5" y="62.3027">Metastore</text><path d="M1126.5,13 C1126.5,3 1144.5,3 1144.5,3 C1144.5,3 1162.5,3 1162.5,13 L1162.5,39 C1162.5,49 1144.5,49 1144.5,49 C1144.5,49 1126.5,49 1126.5,39 L1126.5,13 " fill="#FEFECE" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1126.5,13 C1126.5,23 1144.5,23 1144.5,23 C1144.5,23 1162.5,23 1162.5,13 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="1107.5" y="1511.5249">Metastore</text><path d="M1126.5,1524.5122 C1126.5,1514.5122 1144.5,1514.5122 1144.5,1514.5122 C1144.5,1514.5122 1162.5,1514.5122 1162.5,1524.5122 L1162.5,1550.5122 C1162.5,1560.5122 1144.5,1560.5122 1144.5,1560.5122 C1144.5,1560.5122 1126.5,1560.5122 1126.5,1550.5122 L1126.5,1524.5122 " fill="#FEFECE" style="stroke: #000000; stroke-width: 1.5;"/><path d="M1126.5,1524.5122 C1126.5,1534.5122 1144.5,1534.5122 1144.5,1534.5122 C1144.5,1534.5122 1162.5,1534.5122 1162.5,1524.5122 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="1191.5" y="62.3027">KMS</text><ellipse cx="1209" cy="33" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1197" x2="1221" y1="47" y2="47"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="1191.5" y="1511.5249">KMS</text><ellipse cx="1209" cy="1530.5122" fill="#FEFECE" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1197" x2="1221" y1="1544.5122" y2="1544.5122"/><rect fill="#FFFFFF" height="1271.4263" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="535" y="167.6694"/><rect fill="#FFFFFF" height="441.644" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1054" y="351.3018"/><rect fill="#FFFFFF" height="271.0117" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1054" y="988.5781"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="96.4165" y2="96.4165"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="96.4165" y2="109.4165"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="109.4165" y2="109.4165"/><polygon fill="#A80036" points="200,105.4165,190,109.4165,200,113.4165,196,109.4165" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="196" y="91.6426">service startup initiated</text><polygon fill="#A80036" points="370,134.543,380,138.543,370,142.543,374,138.543" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="376" y1="138.543" y2="138.543"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="196" y="133.769">build new session factory</text><polygon fill="#A80036" points="523,163.6694,533,167.6694,523,171.6694,527,167.6694" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="529" y1="167.6694" y2="167.6694"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="389" y="162.8955">create new cache</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="196.7959" y2="196.7959"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="196.7959" y2="209.7959"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="209.7959" y2="209.7959"/><polygon fill="#A80036" points="200,205.7959,190,209.7959,200,213.7959,196,209.7959" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="196" y="192.022">service startup completes</text><polygon fill="#A80036" points="177,259.9224,187,263.9224,177,267.9224,181,263.9224" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35" x2="183" y1="263.9224" y2="263.9224"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="42" y="259.1484">API call User 1</text><polygon fill="#A80036" points="370,289.0488,380,293.0488,370,297.0488,374,293.0488" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="376" y1="293.0488" y2="293.0488"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="196" y="288.2749">create new session</text><polygon fill="#A80036" points="789,318.1753,799,322.1753,789,326.1753,793,322.1753" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="795" y1="322.1753" y2="322.1753"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="389" y="317.4014">create new instance</text><polygon fill="#A80036" points="1042,347.3018,1052,351.3018,1042,355.3018,1046,351.3018" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1048" y1="351.3018" y2="351.3018"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="808" y="346.5278">create new cache</text><polygon fill="#A80036" points="789,376.4282,799,380.4282,789,384.4282,793,380.4282" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="795" y1="380.4282" y2="380.4282"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="196" y="375.6543">operation 1</text><polygon fill="#A80036" points="1132.5,405.5547,1142.5,409.5547,1132.5,413.5547,1136.5,409.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1138.5" y1="409.5547" y2="409.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="808" y="404.7808">fetch IK</text><polygon fill="#A80036" points="1132.5,434.6812,1142.5,438.6812,1132.5,442.6812,1136.5,438.6812" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1138.5" y1="438.6812" y2="438.6812"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="808" y="433.9072">fetch SK</text><polygon fill="#A80036" points="1197,463.8076,1207,467.8076,1197,471.8076,1201,467.8076" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1203" y1="467.8076" y2="467.8076"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="808" y="463.0337">decrypt SK with MK</text><polygon fill="#A80036" points="556,492.9341,546,496.9341,556,500.9341,552,496.9341" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="550" x2="800" y1="496.9341" y2="496.9341"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="562" y="492.1602">cache SK in protected memory</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="843" y1="526.0605" y2="526.0605"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="843" x2="843" y1="526.0605" y2="539.0605"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="802" x2="843" y1="539.0605" y2="539.0605"/><polygon fill="#A80036" points="812,535.0605,802,539.0605,812,543.0605,808,539.0605" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="808" y="521.2866">decrypt IK with SK</text><polygon fill="#A80036" points="1042,564.187,1052,568.187,1042,572.187,1046,568.187" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1048" y1="568.187" y2="568.187"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="808" y="563.4131">cache IK in protected memory</text><polygon fill="#A80036" points="200,593.3135,190,597.3135,200,601.3135,196,597.3135" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="800" y1="597.3135" y2="597.3135"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="206" y="592.5396">complete operation 1</text><polygon fill="#A80036" points="789,647.4399,799,651.4399,789,655.4399,793,651.4399" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="795" y1="651.4399" y2="651.4399"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="196" y="646.666">operation 2</text><polygon fill="#A80036" points="1042,676.5664,1052,680.5664,1042,684.5664,1046,680.5664" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1048" y1="680.5664" y2="680.5664"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="808" y="675.7925">get IK from protected memory cache</text><polygon fill="#A80036" points="200,705.6929,190,709.6929,200,713.6929,196,709.6929" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="800" y1="709.6929" y2="709.6929"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="206" y="704.9189">complete operation 2</text><polygon fill="#A80036" points="789,759.8193,799,763.8193,789,767.8193,793,763.8193" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="795" y1="763.8193" y2="763.8193"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="196" y="759.0454">close session</text><polygon fill="#A80036" points="1047,788.9458,1057,792.9458,1047,796.9458,1051,792.9458" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1053" y1="792.9458" y2="792.9458"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="808" y="788.1719">securely close cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="1050" x2="1068" y1="783.9458" y2="801.9458"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1050" x2="1068" y1="801.9458" y2="783.9458"/><polygon fill="#A80036" points="46,818.0723,36,822.0723,46,826.0723,42,822.0723" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="40" x2="188" y1="822.0723" y2="822.0723"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="52" y="817.2983">API call User 1 result</text><polygon fill="#A80036" points="177,897.1987,187,901.1987,177,905.1987,181,901.1987" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35" x2="183" y1="901.1987" y2="901.1987"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="42" y="896.4248">API call User 2</text><polygon fill="#A80036" points="370,926.3252,380,930.3252,370,934.3252,374,930.3252" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="376" y1="930.3252" y2="930.3252"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="196" y="925.5513">create new session</text><polygon fill="#A80036" points="789,955.4517,799,959.4517,789,963.4517,793,959.4517" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="795" y1="959.4517" y2="959.4517"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="389" y="954.6777">create new instance</text><polygon fill="#A80036" points="1042,984.5781,1052,988.5781,1042,992.5781,1046,988.5781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1048" y1="988.5781" y2="988.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="808" y="983.8042">create new cache</text><polygon fill="#A80036" points="789,1013.7046,799,1017.7046,789,1021.7046,793,1017.7046" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="795" y1="1017.7046" y2="1017.7046"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="196" y="1012.9307">operation 1</text><polygon fill="#A80036" points="1132.5,1042.8311,1142.5,1046.8311,1132.5,1050.8311,1136.5,1046.8311" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1138.5" y1="1046.8311" y2="1046.8311"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="808" y="1042.0571">fetch IK</text><polygon fill="#A80036" points="556,1071.9575,546,1075.9575,556,1079.9575,552,1075.9575" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="550" x2="800" y1="1075.9575" y2="1075.9575"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="562" y="1071.1836">get SK from protected memory cache</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="843" y1="1105.084" y2="1105.084"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="843" x2="843" y1="1105.084" y2="1118.084"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="802" x2="843" y1="1118.084" y2="1118.084"/><polygon fill="#A80036" points="812,1114.084,802,1118.084,812,1122.084,808,1118.084" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="808" y="1100.3101">decrypt IK with SK</text><polygon fill="#A80036" points="1042,1143.2104,1052,1147.2104,1042,1151.2104,1046,1147.2104" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1048" y1="1147.2104" y2="1147.2104"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="808" y="1142.4365">cache IK in protected memory</text><polygon fill="#A80036" points="200,1172.3369,190,1176.3369,200,1180.3369,196,1176.3369" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="800" y1="1176.3369" y2="1176.3369"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="134" x="206" y="1171.563">complete operation 1</text><polygon fill="#A80036" points="789,1226.4634,799,1230.4634,789,1234.4634,793,1230.4634" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="795" y1="1230.4634" y2="1230.4634"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="196" y="1225.6895">close session</text><polygon fill="#A80036" points="1047,1255.5898,1057,1259.5898,1047,1263.5898,1051,1259.5898" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="801" x2="1053" y1="1259.5898" y2="1259.5898"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="808" y="1254.8159">securely close cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="1050" x2="1068" y1="1250.5898" y2="1268.5898"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="1050" x2="1068" y1="1268.5898" y2="1250.5898"/><polygon fill="#A80036" points="46,1284.7163,36,1288.7163,46,1292.7163,42,1288.7163" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="40" x2="188" y1="1288.7163" y2="1288.7163"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="52" y="1283.9424">API call User 2 result</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="1367.8428" y2="1367.8428"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="1367.8428" y2="1380.8428"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="1380.8428" y2="1380.8428"/><polygon fill="#A80036" points="200,1376.8428,190,1380.8428,200,1384.8428,196,1380.8428" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="196" y="1363.0688">service shutdown initiated</text><polygon fill="#A80036" points="370,1405.9692,380,1409.9692,370,1413.9692,374,1409.9692" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="376" y1="1409.9692" y2="1409.9692"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="196" y="1405.1953">close session factory</text><polygon fill="#A80036" points="528,1435.0957,538,1439.0957,528,1443.0957,532,1439.0957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="382" x2="534" y1="1439.0957" y2="1439.0957"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="389" y="1434.3218">securely close cache</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="531" x2="549" y1="1430.0957" y2="1448.0957"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="531" x2="549" y1="1448.0957" y2="1430.0957"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="231" y1="1468.2222" y2="1468.2222"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="231" x2="231" y1="1468.2222" y2="1481.2222"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="190" x2="231" y1="1481.2222" y2="1481.2222"/><polygon fill="#A80036" points="200,1477.2222,190,1481.2222,200,1485.2222,196,1481.2222" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="196" y="1463.4482">service shutdown completes</text><rect fill="#DDDDDD" height="111.7402" rx="5" ry="5" style="stroke: #000000; stroke-width: 1.0;" width="301" x="11" y="1569.5122"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="35" x="22" y="1589.8491">Type</text><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="83" x="67" y="1589.8491">Description</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="21" x="21" y="1606.105">MK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="208" x="66" y="1606.105">Master Key, root key from KMS</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="17" x="21" y="1622.395">SK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="197" x="66" y="1622.395">System Key, encrypted by MK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="13" x="21" y="1638.6851">IK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="232" x="66" y="1638.6851">Intermediate Key, encrypted by SK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="21" y="1654.9751">DRK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="205" x="66" y="1654.9751">Data Row Key, encrypted by IK</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="21" y="1671.2651">DRR</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="236" x="66" y="1671.2651">encrypted data and encrypted DRK</text><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="306" y1="1576.5122" y2="1576.5122"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="306" y1="1592.8022" y2="1592.8022"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="306" y1="1609.0923" y2="1609.0923"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="306" y1="1625.3823" y2="1625.3823"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="306" y1="1641.6724" y2="1641.6724"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="306" y1="1657.9624" y2="1657.9624"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="306" y1="1674.2524" y2="1674.2524"/><line style="stroke: #000000; stroke-width: 1.0;" x1="17" x2="17" y1="1576.5122" y2="1674.2524"/><line style="stroke: #000000; stroke-width: 1.0;" x1="62" x2="62" y1="1576.5122" y2="1674.2524"/><line style="stroke: #000000; stroke-width: 1.0;" x1="306" x2="306" y1="1576.5122" y2="1674.2524"/><!--
@startuml

skinparam shadowing false

legend left
|= Type |= Description |
| MK | Master Key, root key from KMS |
| SK | System Key, encrypted by MK |
| IK | Intermediate Key, encrypted by SK |
| DRK | Data Row Key, encrypted by IK |
| DRR | encrypted data and encrypted DRK |
endlegend

participant Caller
participant API
boundary AppEncryptionSessionFactory
collections "SK Cache"
boundary AppEncryption
collections "IK Cache"
database Metastore
entity KMS

API -> API : service startup initiated
API -> AppEncryptionSessionFactory : build new session factory
AppEncryptionSessionFactory -> "SK Cache" : create new cache
activate "SK Cache"
API -> API : service startup completes
|||
Caller -> API : API call User 1
API -> AppEncryptionSessionFactory : create new session
AppEncryptionSessionFactory -> AppEncryption : create new instance
AppEncryption -> "IK Cache" : create new cache
activate "IK Cache"
API -> AppEncryption : operation 1
AppEncryption -> Metastore : fetch IK
AppEncryption -> Metastore : fetch SK
AppEncryption -> KMS : decrypt SK with MK
AppEncryption -> "SK Cache" : cache SK in protected memory
AppEncryption -> AppEncryption : decrypt IK with SK
AppEncryption -> "IK Cache" : cache IK in protected memory
AppEncryption -> API : complete operation 1
|||
API -> AppEncryption : operation 2
AppEncryption -> "IK Cache" : get IK from protected memory cache
AppEncryption -> API : complete operation 2
|||
API -> AppEncryption : close session
AppEncryption -> "IK Cache" : securely close cache
destroy "IK Cache"
API -> Caller : API call User 1 result
|||
|||
Caller -> API : API call User 2
API -> AppEncryptionSessionFactory : create new session
AppEncryptionSessionFactory -> AppEncryption : create new instance
AppEncryption -> "IK Cache" : create new cache
activate "IK Cache"
API -> AppEncryption : operation 1
AppEncryption -> Metastore : fetch IK
AppEncryption -> "SK Cache" : get SK from protected memory cache
AppEncryption -> AppEncryption : decrypt IK with SK
AppEncryption -> "IK Cache" : cache IK in protected memory
AppEncryption -> API : complete operation 1
|||
API -> AppEncryption : close session
AppEncryption -> "IK Cache" : securely close cache
destroy "IK Cache"
API -> Caller : API call User 2 result
|||
|||
API -> API : service shutdown initiated
API -> AppEncryptionSessionFactory : close session factory
AppEncryptionSessionFactory -> "SK Cache" : securely close cache
destroy "SK Cache"
API -> API : service shutdown completes

@enduml

PlantUML version 1.2018.05(Sat May 05 20:00:17 GMT 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_161-b12
Operating System: Linux
OS Version: 4.9.125-linuxkit
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>